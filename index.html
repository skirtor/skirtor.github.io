
<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="bimwook.com" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <title>Radio - bimwook.com</title>
    <style type="text/css">
      html {margin:0; padding:0; font-size: 16px; background: gray;}
      body {margin:0 auto; padding:0; width: 100%; max-width: 980px; font-size: 1em; line-height: 1.8; font-family: verdana, "Microsoft Yahei"; }
      img  {max-width: 100%; background-color: #EAEAEA; display:block; margin: 0 auto;}
      h1,h2,h3,h4,h5,h6 { text-indent: 16px; padding:0; margin: 0.5em auto; line-height: 1.2; }
      h1 {font-size: 1.8em;}
      h2 {font-size: 1.6em;}
      h3 {font-size: 1.5em;}
      h4 {font-size: 1.4em;}
      h5 {font-size: 1.2em;}
      h6 {font-size: 1.0em;}
      a {text-decoration: none; color:#006291;}
      a:link {color:#006291;}
      a:visited {color:#006291;}
      a:hover{ text-decoration: none; color: #FF6633;}
      hr{ border: none; height: 1px; background: #DDDDDD; }
      p{margin: 0; padding: 0; text-indent: 2em;}
      em { font-style: normal; font-weight: normal; }
      blockquote{ margin: 2em; padding: 8px; text-indent: 0; border-left: solid 5px silver; background-color: #EEEEEE;}
      .tag{font-size: 0.9em; border: solid 1px silver; border-radius: 3px; padding: 4px; background-color: #EEEEEE; color: gray; vertical-align: middle;}
      .bar {padding: 4px 16px; color: gray; background-color: #EAEAEA; }
      .small { font-size:0.875em; }
      #content {color: #646464; padding: 2em 6em; background-color: white; overflow: hidden; font-size: 0.875rem; line-height: 2; }
      #likeit {cursor: pointer; padding: 0 8px; color:#006291; margin-left: 8px; background-color: #FAFAFA;}
      #likeit:active {background-color: white;}
      #share {padding: 2em 6em; display: block; overflow: hidden; background-color: #FAFAFA;}
      #share .qr-code {float: left;}
      #share .memo {float: left; margin: 0; padding: 8px; list-style-type: none;}
      #data {display: none;}
      @media screen and (max-width: 639px) {
        body { font-size: 0.875rem; }
        #content{ padding: 0.5em 2em; font-size: 0.875rem;  overflow: hidden; }
        #share{ display: none; }
      }
      @media screen and (max-width: 479px) {
        #content{ padding: 0.5em 1em; overflow: hidden; }
        #share{ display: none; }
      }
    </style>
    <script type="text/javascript" src="/common/o-muen.js"></script>
    <script type="text/javascript" src="/common/o-marked.js"></script>
    <script type="text/javascript" src="/common/o-base64.js"></script>
  </head>
  <body>
    <div class="bar">
      <a href="/">八月远方</a>
      <em> | </em>
      <em id="title" class="small"></em>
    </div>    
    <div id="content">正在加载...</div>
    <div id="share">
      <img id="qr-code" class="qr-code" src="/img/opacity.png" alt="QR-Code" />
      <ul class="memo">
        <li>用手机扫描二维码</li>
        <li>分享本文到您的社交平台</li>
      </ul>
    </div>
    <div class="bar">
      <em>&copy; bimwook </em>
      <em class="small">| www.bimwook.com | omuen.com | Since 2006</em>
    </div>
    <script type="text/javascript">
      -function(){
        var $ = function(id){
          return {
            dom: document.querySelector(id),
            html: function(data){
              var me = this;
              if(typeof(data)=="string"){
                me.dom.innerHTML = data;
              }
              else {
                return me.dom.innerHTML;
              }
            },
            text: function(data){
              var me = this;
              if(typeof(data)=="string"){
                me.dom.innerText = data;
              }
              else {
                return me.dom.innerText;
              }
            },
            append: function(node){
              this.dom.appendChild(node);
            }
          }
        };
        var fn={};
        fn.throttle = function(fn, delay){
          var me = this;
          var timer=null;
          return function(){
            var context=this, args=arguments;
            window.clearTimeout(timer);
            timer = window.setTimeout(function(){ fn.apply(me, args); },delay);
          }
        };
        var vx={};
        vx.rowid="";
        vx.encode = function(s){
          return s.replace(/\r/g, "").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
        };
        vx.lazyload = {
          items: [], 
          clear: function(){
            items = [];
          },
          run: function(){
            var me = this;
            var top = (document.documentElement.scrollTop || document.body.scrollTop);
            var line = top + document.documentElement.clientHeight;
            var rest = [];
            while(me.items.length>0){
              var img = me.items.pop();
              var t = img.offsetTop;
              if((t>=top) && (t<=line)) {
                img.onload = function(){
                  this.style.cursor = "pointer";
                  this.style.width="auto";
                  this.style.background = "#EAEAEA";
                  this.onclick = function(){  
                    window.open(this.src);
                  };
                };
                img.onerror = function(){
                  this.style.cursor = "pointer";
                  var src= this.src;
                  this.onclick = function(){  
                    this.src = src;
                  };
                  this.src="/img/opacity.png";
                }
                img.src = img.status.src;
              }
              else{
                rest.push(img);
              }
            }
            me.items = rest.reverse();
            if(me.items.length==0) {
              window.onscroll = null;
            }
          },
          load: function(id, host){
            var me = this;
            var nodes = $(id).dom.getElementsByTagName("img");
            var list = [];
            for(var i=0; i<nodes.length; i++){ 
              list.push(nodes[i]);
            }
            list.reverse();
            for(var i=0; i<list.length; i++){ 
              var img = list[i];
              var src = img.attributes["data-src"]||{name:"",value:"/img/opacity.png"};
              img.src= "/img/opacity.png";
              img.style.width="100%";
              img.style.height = "auto";
              img.style.background = "silver url(/svg/loading.svg) no-repeat center center";
              img.style.backgroundSize = "3rem 3rem";
              img.status={loaded:false, src: src.value};
              me.items.push(img);
            }
            window.onscroll = fn.throttle(function(){ me.run(); }, 500);
            this.run();
          }
        };        
        vx.load = function(host){
          var me = this;
          var base64 = window.Modules.load("base64");
          var marked = window.Modules.load("marked"); 
          var ajax = window.Modules.load("ajax");  
          var rowid = (window.location.search.match(/\?(\d{48})/)||["","0"])[1];
          var x = "/woo/bin/radio/view.html?rowid=" + rowid;
          if(rowid=="0") {
            x = "/woo/bin/radio/random.do";
          }
          ajax.get("https://" + host + x, function(o){
            var mc = o.text.match(/<div id="data" data-encoding="base64">([^<]*)/);
            if(mc){
              var text = base64.decode(mc[1]);
              var html = marked.parse(me.encode(text));
              var location = window.encodeURIComponent(window.location.href);
              if(x==="/woo/bin/radio/random.do"){
                history.replaceState("", "", "?" + (o.text.match(/name="woo:rowid" content="(\d{48})"/)||["",""])[1]);              
              }
              $("#content").html(html.replace(/<img src="/g, '<img data-src="https://' + host));
              me.lazyload.load("#content", host);
              //document.title = me.title(text);
              $("#qr-code").dom.src= "https://" + host + "/woo/bin/barcode/twod.do?barcode=" + location;
              $("#title").text( (o.text.match(/id="created" class="bar">([^<]*)</)||["",""])[1] );
            }
          });
        };
        vx.load("www.bimwook.com:11180");
        vx.load("local.bimwook.com");
      }();
    </script>
  </body>
</html>
